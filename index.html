<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ïï± Î¶¨Î∑∞ ÎåÄÏãúÎ≥¥Îìú</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #0f1419;
            color: #e4e6eb;
            padding: 20px;
        }
        
        .header {
            background: linear-gradient(135deg, #1a1f2e 0%, #2d3748 100%);
            color: white;
            padding: 30px;
            border-radius: 16px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            border: 1px solid #2d3748;
        }
        
        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .header p {
            font-size: 14px;
            opacity: 0.7;
            font-weight: 300;
        }
        
        .header .warning {
            margin-top: 12px;
            padding: 10px 16px;
            background: rgba(217, 130, 43, 0.15);
            border: 1px solid rgba(217, 130, 43, 0.3);
            border-radius: 8px;
            font-size: 13px;
            color: #e3b341;
            display: inline-block;
        }
        
        .filters {
            background: #1a1f2e;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            border: 1px solid #2d3748;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .filter-group label {
            font-size: 11px;
            font-weight: 600;
            color: #8b949e;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .filter-group select,
        .filter-group input {
            padding: 10px 14px;
            border: 1px solid #2d3748;
            border-radius: 8px;
            font-size: 14px;
            min-width: 150px;
            background: #0f1419;
            color: #e4e6eb;
        }
        
        .filter-group select:focus,
        .filter-group input:focus {
            outline: none;
            border-color: #58a6ff;
        }
        
        .refresh-btn {
            padding: 11px 24px;
            background: #238636;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 18px;
            font-size: 14px;
            transition: background 0.2s;
        }
        
        .refresh-btn:hover {
            background: #2ea043;
        }
        
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .data-info {
            background: #1a1f2e;
            padding: 12px 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #2d3748;
            color: #8b949e;
            font-size: 13px;
            text-align: center;
        }
        
        .data-info strong {
            color: #58a6ff;
            font-weight: 600;
        }
        
        .kpi-card {
            background: #1a1f2e;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            border: 1px solid #2d3748;
        }
        
        .kpi-card .label {
            font-size: 12px;
            color: #8b949e;
            margin-bottom: 10px;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        
        .kpi-card .value {
            font-size: 36px;
            font-weight: 700;
            color: #e4e6eb;
            margin-bottom: 8px;
        }
        
        .kpi-card .change {
            font-size: 13px;
            color: #8b949e;
            font-weight: 400;
        }
        
        .kpi-card.positive .value {
            color: #3fb950;
        }
        
        .kpi-card.neutral .value {
            color: #58a6ff;
        }
        
        .kpi-card.negative .value {
            color: #f85149;
        }
        
        .analysis-section {
            background: #1a1f2e;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            border: 1px solid #2d3748;
        }
        
        .analysis-section h2 {
            font-size: 20px;
            margin-bottom: 20px;
            color: #e4e6eb;
            font-weight: 600;
        }
        
        .analysis-content {
            background: #0f1419;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #2d3748;
            line-height: 1.6;
            color: #c9d1d9;
        }
        
        .analysis-content h3 {
            color: #58a6ff;
            font-size: 16px;
            margin-top: 15px;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .analysis-content h3:first-child {
            margin-top: 0;
        }
        
        .analysis-content ul {
            margin-left: 20px;
            margin-top: 8px;
        }
        
        .analysis-content li {
            margin-bottom: 6px;
            color: #8b949e;
        }
        
        .analysis-loading {
            text-align: center;
            padding: 40px;
            color: #8b949e;
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .chart-card {
            background: #1a1f2e;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            border: 1px solid #2d3748;
        }
        
        .chart-card h3 {
            font-size: 16px;
            margin-bottom: 20px;
            color: #e4e6eb;
            font-weight: 600;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
        }
        
        .table-card {
            background: #1a1f2e;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            border: 1px solid #2d3748;
            overflow-x: auto;
        }
        
        .table-card h3 {
            font-size: 16px;
            margin-bottom: 20px;
            color: #e4e6eb;
            font-weight: 600;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background: #0f1419;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            font-size: 12px;
            color: #8b949e;
            border-bottom: 1px solid #2d3748;
            position: sticky;
            top: 0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        td {
            padding: 12px;
            border-bottom: 1px solid #21262d;
            font-size: 14px;
            color: #c9d1d9;
        }
        
        tr:hover {
            background: #161b22;
        }
        
        .rating-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 12px;
        }
        
        .rating-5 { background: #1f6f4a; color: #3fb950; }
        .rating-4 { background: #1f6f4a; color: #56d364; }
        .rating-3 { background: #341a00; color: #d29922; }
        .rating-2 { background: #5a1e1e; color: #f85149; }
        .rating-1 { background: #5a1e1e; color: #ff7b72; }
        
        .device-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 11px;
            text-transform: uppercase;
        }
        
        .device-ios {
            background: #1f2937;
            color: #58a6ff;
        }
        
        .device-android {
            background: #1f6f4a;
            color: #56d364;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 18px;
            color: #8b949e;
        }
        
        .error {
            background: #5a1e1e;
            color: #ff7b72;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #ff7b72;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üìä Ïï± Î¶¨Î∑∞ ÎåÄÏãúÎ≥¥Îìú</h1>
        <p>Ïã§ÏãúÍ∞Ñ Î¶¨Î∑∞ Î™®ÎãàÌÑ∞ÎßÅ Î∞è Ïù∏ÏÇ¨Ïù¥Ìä∏ Î∂ÑÏÑù</p>
        <div class="warning">
            ‚ö†Ô∏è Îç∞Ïù¥ÌÑ∞Îäî 2-3Ïùº ÏßÄÏó∞ÎêòÏñ¥ Ï†úÍ≥µÎê©ÎãàÎã§ (Apple Ï†ïÏ±ÖÏúºÎ°ú Ïù∏Ìïú ÏßÄÏó∞)
        </div>
    </div>
    
    <div class="filters">
        <div class="filter-group">
            <label>Ïä§ÌÜ†Ïñ¥</label>
            <select id="storeFilter">
                <option value="all">Ï†ÑÏ≤¥</option>
                <option value="ios">iOS</option>
                <option value="android">Android</option>
            </select>
        </div>
        
        <div class="filter-group">
            <label>ÌèâÏ†ê</label>
            <select id="ratingFilter">
                <option value="all">Ï†ÑÏ≤¥</option>
                <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</option>
                <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê</option>
                <option value="3">‚≠ê‚≠ê‚≠ê</option>
                <option value="2">‚≠ê‚≠ê</option>
                <option value="1">‚≠ê</option>
            </select>
        </div>
        
        <div class="filter-group">
            <label>Í∏∞Í∞Ñ (ÏãúÏûë)</label>
            <input type="date" id="startDate">
        </div>
        
        <div class="filter-group">
            <label>Í∏∞Í∞Ñ (Ï¢ÖÎ£å)</label>
            <input type="date" id="endDate">
        </div>
        
        <button class="refresh-btn" onclick="loadData()">üîÑ ÏÉàÎ°úÍ≥†Ïπ®</button>
    </div>
    
    <div id="loading" class="loading">Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...</div>
    <div id="error" class="error" style="display: none;"></div>
    
    <div id="dashboard" style="display: none;">
        <div class="data-info" id="dataInfo">
            Îç∞Ïù¥ÌÑ∞ Í∏∞Ï§Ä: <strong id="latestDataDate">-</strong> (Ïã§ÏãúÍ∞Ñ -3Ïùº)
        </div>
        
        <div class="kpi-grid">
            <div class="kpi-card">
                <div class="label">Ï†ÑÏ≤¥ Î¶¨Î∑∞ Ïàò</div>
                <div class="value" id="totalReviews">0</div>
                <div class="change" id="reviewsChange"></div>
            </div>
            
            <div class="kpi-card">
                <div class="label">ÌèâÍ∑† ÌèâÏ†ê</div>
                <div class="value" id="avgRating">0.0</div>
                <div class="change">‚≠ê</div>
            </div>
            
            <div class="kpi-card positive">
                <div class="label">Í∏çÏ†ï Î¶¨Î∑∞ (4-5Ï†ê)</div>
                <div class="value" id="positiveRate">0%</div>
                <div class="change" id="positiveCount">0Í∞ú</div>
            </div>
            
            <div class="kpi-card neutral">
                <div class="label">Ï§ëÎ¶Ω Î¶¨Î∑∞ (3Ï†ê)</div>
                <div class="value" id="neutralRate">0%</div>
                <div class="change" id="neutralCount">0Í∞ú</div>
            </div>
            
            <div class="kpi-card negative">
                <div class="label">Î∂ÄÏ†ï Î¶¨Î∑∞ (1-2Ï†ê)</div>
                <div class="value" id="negativeRate">0%</div>
                <div class="change" id="negativeCount">0Í∞ú</div>
            </div>
        </div>
        
        <div class="analysis-section">
            <h2>ü§ñ AI Î¶¨Î∑∞ Î∂ÑÏÑù</h2>
            <div id="analysisContent" class="analysis-content">
                <div class="analysis-loading">Î∂ÑÏÑù Í≤∞Í≥ºÎ•º Î∂àÎü¨Ïò§Îäî Ï§ë...</div>
            </div>
        </div>
        
        <div class="charts-grid">
            <div class="chart-card">
                <h3>üìà ÌèâÏ†ê Ï∂îÏù¥</h3>
                <div class="chart-container">
                    <canvas id="trendChart"></canvas>
                </div>
            </div>
            
            <div class="chart-card">
                <h3>üìä ÌèâÏ†ê Î∂ÑÌè¨</h3>
                <div class="chart-container">
                    <canvas id="distributionChart"></canvas>
                </div>
            </div>
        </div>
        
        <div class="charts-grid">
            <div class="chart-card">
                <h3>üì± Ïä§ÌÜ†Ïñ¥Î≥Ñ ÎπÑÍµê</h3>
                <div class="chart-container">
                    <canvas id="storeChart"></canvas>
                </div>
            </div>
            
            <div class="chart-card">
                <h3>üåç Íµ≠Í∞ÄÎ≥Ñ Î¶¨Î∑∞ Ïàò</h3>
                <div class="chart-container">
                    <canvas id="countryChart"></canvas>
                </div>
            </div>
        </div>
        
        <div class="table-card">
            <h3>üìù ÏµúÍ∑º Î¶¨Î∑∞</h3>
            <table>
                <thead>
                    <tr>
                        <th>ÎÇ†Ïßú</th>
                        <th>Ïä§ÌÜ†Ïñ¥</th>
                        <th>ÌèâÏ†ê</th>
                        <th>Ï†úÎ™©</th>
                        <th>ÎÇ¥Ïö©</th>
                        <th>Íµ≠Í∞Ä</th>
                        <th>Î≤ÑÏ†Ñ</th>
                    </tr>
                </thead>
                <tbody id="reviewsTable"></tbody>
            </table>
        </div>
    </div>

    <script>
        const SHEET_ID = '1o0d8rSCZD7SbDQmk6NX3Cpg8LYJPNVv3OaW4j51P1tY';
        const SHEET_NAME = 'sheet';
        const ANALYSIS_SHEET_NAME = 'analysis';
        
        let allData = [];
        let charts = {};
        
        Chart.register(ChartDataLabels);
        
        // ÎÇ†Ïßú ÌïÑÌÑ∞ Ï¥àÍ∏∞Í∞í ÏÑ§Ï†ï
        const today = new Date();
        const thirtyDaysAgo = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000);
        document.getElementById('startDate').valueAsDate = thirtyDaysAgo;
        document.getElementById('endDate').valueAsDate = today;
        
        // ÌïÑÌÑ∞ Î≥ÄÍ≤Ω Ïãú ÎåÄÏãúÎ≥¥Îìú ÏóÖÎç∞Ïù¥Ìä∏
        document.getElementById('storeFilter').addEventListener('change', updateDashboard);
        document.getElementById('ratingFilter').addEventListener('change', updateDashboard);
        document.getElementById('startDate').addEventListener('change', updateDashboard);
        document.getElementById('endDate').addEventListener('change', updateDashboard);
        
        async function loadData() {
            try {
                document.getElementById('loading').style.display = 'block';
                document.getElementById('error').style.display = 'none';
                document.getElementById('dashboard').style.display = 'none';
                
                const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${SHEET_NAME}`;
                
                const response = await fetch(url);
                const csvText = await response.text();
                
                Papa.parse(csvText, {
                    header: true,
                    skipEmptyLines: true,
                    complete: function(results) {
                        allData = results.data.map(row => ({
                            date: row.date,
                            product_name: row.product_name,
                            device: row.device,
                            rating: parseInt(row.rating),
                            title: row.title,
                            text: row.text,
                            version: row.version,
                            country: row.country,
                            language: row.language,
                            review_id: row.review_id
                        })).filter(row => row.date && row.rating);
                        
                        document.getElementById('loading').style.display = 'none';
                        document.getElementById('dashboard').style.display = 'block';
                        
                        updateDashboard();
                        loadAnalysis();
                    }
                });
            } catch (error) {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
                document.getElementById('error').textContent = 'Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message + '\n\nÍµ¨Í∏Ä ÏãúÌä∏Í∞Ä "ÎßÅÌÅ¨Í∞Ä ÏûàÎäî Î™®Îì† ÏÇ¨Ïö©Ïûê"Î°ú Í≥µÏú† ÏÑ§Ï†ïÎêòÏñ¥ ÏûàÎäîÏßÄ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.';
            }
        }
        
        async function loadAnalysis() {
            try {
                const analysisUrl = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${ANALYSIS_SHEET_NAME}`;
                
                const response = await fetch(analysisUrl);
                const csvText = await response.text();
                
                Papa.parse(csvText, {
                    header: true,
                    skipEmptyLines: true,
                    complete: function(results) {
                        if (results.data && results.data.length > 0) {
                            const latestAnalysis = results.data[results.data.length - 1];
                            displayAnalysis(latestAnalysis);
                        } else {
                            document.getElementById('analysisContent').innerHTML = '<div class="analysis-loading">ÏïÑÏßÅ Î∂ÑÏÑù Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§. n8n ÏõåÌÅ¨ÌîåÎ°úÏö∞Î•º Ïã§ÌñâÌï¥Ï£ºÏÑ∏Ïöî.</div>';
                        }
                    }
                });
            } catch (error) {
                document.getElementById('analysisContent').innerHTML = '<div class="analysis-loading">Î∂ÑÏÑù Í≤∞Í≥ºÎ•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.</div>';
            }
        }
        
        function displayAnalysis(analysis) {
            const content = document.getElementById('analysisContent');
            content.innerHTML = `
                <h3>üìä Í∞êÏÑ± Î∂ÑÏÑù</h3>
                <p>${analysis.sentiment_summary || 'Î∂ÑÏÑù Ï§ë...'}</p>
                
                <h3>üîç Ï£ºÏöî Ïù¥Ïäà</h3>
                <ul>
                    ${(analysis.main_issues || '').split('\n').filter(i => i.trim()).map(issue => `<li>${issue}</li>`).join('')}
                </ul>
                
                <h3>üí° Í∞úÏÑ† Ï†úÏïà</h3>
                <ul>
                    ${(analysis.suggestions || '').split('\n').filter(s => s.trim()).map(suggestion => `<li>${suggestion}</li>`).join('')}
                </ul>
                
                <p style="margin-top: 20px; color: #8b949e; font-size: 12px;">
                    Î∂ÑÏÑù ÏùºÏãú: ${analysis.analysis_date || new Date().toLocaleDateString()}
                </p>
            `;
        }
        
        function filterData() {
            const storeFilter = document.getElementById('storeFilter').value;
            const ratingFilter = document.getElementById('ratingFilter').value;
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            return allData.filter(row => {
                if (storeFilter !== 'all' && row.device !== storeFilter) return false;
                if (ratingFilter !== 'all' && row.rating !== parseInt(ratingFilter)) return false;
                if (startDate && row.date < startDate) return false;
                if (endDate && row.date > endDate) return false;
                return true;
            });
        }
        
        function updateDashboard() {
            const data = filterData();
            
            // ÏµúÏã† Îç∞Ïù¥ÌÑ∞ ÎÇ†Ïßú ÌëúÏãú
            if (data.length > 0) {
                const latestDate = data.reduce((latest, row) => {
                    return row.date > latest ? row.date : latest;
                }, data[0].date);
                document.getElementById('latestDataDate').textContent = latestDate;
            }
            
            // KPI ÏóÖÎç∞Ïù¥Ìä∏
            updateKPIs(data);
            
            // Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
            updateTrendChart(data);
            updateDistributionChart(data);
            updateStoreChart(data);
            updateCountryChart(data);
            
            // ÌÖåÏù¥Î∏î ÏóÖÎç∞Ïù¥Ìä∏
            updateTable(data);
        }
        
        function updateKPIs(data) {
            const total = data.length;
            const avgRating = (data.reduce((sum, r) => sum + r.rating, 0) / total || 0).toFixed(1);
            const positive = data.filter(r => r.rating >= 4).length;
            const neutral = data.filter(r => r.rating === 3).length;
            const negative = data.filter(r => r.rating <= 2).length;
            const positiveRate = ((positive / total * 100) || 0).toFixed(1);
            const neutralRate = ((neutral / total * 100) || 0).toFixed(1);
            const negativeRate = ((negative / total * 100) || 0).toFixed(1);
            
            document.getElementById('totalReviews').textContent = total.toLocaleString();
            document.getElementById('avgRating').textContent = avgRating;
            document.getElementById('positiveRate').textContent = positiveRate + '%';
            document.getElementById('positiveCount').textContent = positive.toLocaleString() + 'Í∞ú';
            document.getElementById('neutralRate').textContent = neutralRate + '%';
            document.getElementById('neutralCount').textContent = neutral.toLocaleString() + 'Í∞ú';
            document.getElementById('negativeRate').textContent = negativeRate + '%';
            document.getElementById('negativeCount').textContent = negative.toLocaleString() + 'Í∞ú';
            
            // iOS vs Android ÎπÑÏú®
            const ios = data.filter(r => r.device === 'ios').length;
            const android = data.filter(r => r.device === 'android').length;
            document.getElementById('reviewsChange').textContent = `iOS: ${ios} | Android: ${android}`;
        }
        
        function updateTrendChart(data) {
            const ctx = document.getElementById('trendChart');
            
            // ÎÇ†ÏßúÎ≥ÑÎ°ú Í∑∏Î£πÌôî
            const dateGroups = {};
            data.forEach(row => {
                if (!dateGroups[row.date]) {
                    dateGroups[row.date] = [];
                }
                dateGroups[row.date].push(row.rating);
            });
            
            const dates = Object.keys(dateGroups).sort();
            const avgRatings = dates.map(date => {
                const ratings = dateGroups[date];
                return (ratings.reduce((a, b) => a + b, 0) / ratings.length).toFixed(2);
            });
            
            if (charts.trend) charts.trend.destroy();
            
            charts.trend = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'ÌèâÍ∑† ÌèâÏ†ê',
                        data: avgRatings,
                        borderColor: '#58a6ff',
                        backgroundColor: 'rgba(88, 166, 255, 0.1)',
                        tension: 0.4,
                        fill: true,
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            display: false
                        },
                        datalabels: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 5,
                            ticks: { color: '#8b949e' },
                            grid: { color: '#21262d' }
                        },
                        x: {
                            ticks: { color: '#8b949e' },
                            grid: { color: '#21262d' }
                        }
                    }
                }
            });
        }
        
        function updateDistributionChart(data) {
            const ctx = document.getElementById('distributionChart');
            
            const distribution = [1, 2, 3, 4, 5].map(rating => 
                data.filter(r => r.rating === rating).length
            );
            
            if (charts.distribution) charts.distribution.destroy();
            
            charts.distribution = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['‚≠ê', '‚≠ê‚≠ê', '‚≠ê‚≠ê‚≠ê', '‚≠ê‚≠ê‚≠ê‚≠ê', '‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê'],
                    datasets: [{
                        label: 'Î¶¨Î∑∞ Ïàò',
                        data: distribution,
                        backgroundColor: [
                            '#f85149',
                            '#ff7b72',
                            '#d29922',
                            '#56d364',
                            '#3fb950'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        datalabels: {
                            color: '#e4e6eb',
                            font: { weight: 'bold', size: 14 },
                            anchor: 'end',
                            align: 'top'
                        }
                    },
                    scales: {
                        y: {
                            ticks: { color: '#8b949e' },
                            grid: { color: '#21262d' }
                        },
                        x: {
                            ticks: { color: '#8b949e' },
                            grid: { display: false }
                        }
                    }
                }
            });
        }
        
        function updateStoreChart(data) {
            const ctx = document.getElementById('storeChart');
            
            const ios = data.filter(r => r.device === 'ios');
            const android = data.filter(r => r.device === 'android');
            
            const iosAvg = (ios.reduce((sum, r) => sum + r.rating, 0) / ios.length || 0).toFixed(2);
            const androidAvg = (android.reduce((sum, r) => sum + r.rating, 0) / android.length || 0).toFixed(2);
            
            if (charts.store) charts.store.destroy();
            
            charts.store = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['iOS', 'Android'],
                    datasets: [
                        {
                            label: 'Î¶¨Î∑∞ Ïàò',
                            data: [ios.length, android.length],
                            backgroundColor: ['#58a6ff', '#3fb950'],
                            yAxisID: 'y'
                        },
                        {
                            label: 'ÌèâÍ∑† ÌèâÏ†ê',
                            data: [iosAvg, androidAvg],
                            type: 'line',
                            borderColor: '#d29922',
                            backgroundColor: '#d29922',
                            yAxisID: 'y1',
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        datalabels: {
                            color: '#e4e6eb',
                            font: { weight: 'bold', size: 14 },
                            formatter: function(value, context) {
                                if (context.dataset.type === 'line') {
                                    return value;
                                }
                                return value;
                            }
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            ticks: { color: '#8b949e' },
                            grid: { color: '#21262d' }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            max: 5,
                            ticks: { color: '#8b949e' },
                            grid: {
                                drawOnChartArea: false
                            }
                        },
                        x: {
                            ticks: { color: '#8b949e' },
                            grid: { display: false }
                        }
                    }
                }
            });
        }
        
        function updateCountryChart(data) {
            const ctx = document.getElementById('countryChart');
            
            const countryGroups = {};
            data.forEach(row => {
                const country = row.country || 'Unknown';
                countryGroups[country] = (countryGroups[country] || 0) + 1;
            });
            
            const sortedCountries = Object.entries(countryGroups)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);
            
            if (charts.country) charts.country.destroy();
            
            charts.country = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: sortedCountries.map(c => c[0]),
                    datasets: [{
                        data: sortedCountries.map(c => c[1]),
                        backgroundColor: [
                            '#58a6ff', '#1f6feb', '#388bfd', '#54a3ff',
                            '#3fb950', '#2ea043', '#56d364', '#46c83e',
                            '#d29922', '#e3b341'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#8b949e' }
                        },
                        datalabels: {
                            color: '#e4e6eb',
                            font: { weight: 'bold', size: 12 }
                        }
                    }
                }
            });
        }
        
        function updateTable(data) {
            const tbody = document.getElementById('reviewsTable');
            const recent = data.sort((a, b) => b.date.localeCompare(a.date)).slice(0, 20);
            
            tbody.innerHTML = recent.map(row => `
                <tr>
                    <td>${row.date}</td>
                    <td><span class="device-badge device-${row.device}">${row.device}</span></td>
                    <td><span class="rating-badge rating-${row.rating}">${'‚≠ê'.repeat(row.rating)}</span></td>
                    <td>${row.title || '-'}</td>
                    <td>${(row.text || '').substring(0, 100)}${row.text && row.text.length > 100 ? '...' : ''}</td>
                    <td>${row.country || '-'}</td>
                    <td>${row.version || '-'}</td>
                </tr>
            `).join('');
        }
        
        // Ï¥àÍ∏∞ Î°úÎìú
        loadData();
    </script>
</body>
</html>